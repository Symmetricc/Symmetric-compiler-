#include"Header.h"
#include<stdio.h>
#include<stdlib.h>



int table[61][27] = {
	{ 1, 1, 1, 2, 5, 5, 45, 47, 6, 22, 24, 13, 34, 26, 30, 49, 41, 54, 54, 57, 54, 54, 5, 54, 55, 105, 106 },
	{ 1, 1, 1, 2, 5, 5, 45, 47, 6, 22, 24, 13, 34, 26, 30, 49, 41, 54, 54, 57, 54, 54, 5, 54, 55, 105, 106 },
	{ 105, 105, 105, 105, 3, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105 },
	{ 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 105 },
	{ 3, 3, 3, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3 },
	{ 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 8, 54, 54, 54, 7, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 9, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 10, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 11, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 12, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 17, 54, 54, 54, 54, 54, 54, 14, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 15, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 16, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 18, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 19, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 20, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 21, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 23, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 25, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 27, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 28, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 29, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 31, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 32, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 33, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 35, 54, 54, 54, 54, 54, 54, 54, 54, 38, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 36, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 37, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 39, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 40, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 42, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 43, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 44, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 105 },
	{ 105, 105, 105, 105, 105, 105, 102, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105 },
	{ 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 105 },
	{ 48, 48, 48, 48, 48, 48, 48, 107, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 105 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 50, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 51, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 52, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 53, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 104, 104, 104, 104, 104, 56, 104, 104, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 104, 105, 55, 105, 104 },
	{ 104, 104, 104, 104, 104, 104, 104, 104, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 105, 104, 105, 55, 105, 104 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 58, 54, 54, 54, 54, 54, 54, 54, 54, 54, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 45, 54, 54, 54, 54, 54, 54, 54, 54, 59, 103, 54, 54, 103, 103 },
	{ 103, 103, 103, 103, 103, 103, 103, 103, 54, 54, 54, 54, 45, 54, 54, 54, 54, 54, 54, 60, 54, 54, 103, 54, 54, 103, 103 },
	{ 101, 101, 101, 101, 101, 101, 101, 101, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 54, 101, 54, 54, 101, 101 },

};

char input[inputsNumber] = { ' ', '\t', '\n', '~', '*', '.', '\'', '"', 'i', 'd', 'o', 'c', 'l', 't', 'n', 'r', 'b', 'h', 'f', 'e', 'g', 's', '#', '|', '&', '*', '-', ' +', '=', ':', '/', '[', ']', '{', '}', '(', ')', '<', '>', ',', ';' };

int GetIndex(char c)
{
	for (int i = 0; i < inputsNumber; i++)
	{
		if (c == input[i])
		{
			if (i < 22)
				return i;
			else
				return 22;
		}
	}
	if ((c > 64 && c < 91) || (c> 96 && c < 123))
		return 23;
	else if (c > 47 && c < 58)
		return 24;
	else if (c == EOF)
		return 26;
	else
		return 25;
}
Token GetNextToken()
{
	Token token;
	int counter = 0;
	int index;
	int state = 0;
	char lexical[BUFF_SIZE];
	char c;
	while (1)
	{
		c = fgetc(sourceFile);
		index = GetIndex(c);
		state = table[state][index];

		//printf("%d , %c , %d \n", state, c, index);
		if (state == 105)
		{
			printf("Syntactical ERROR \n");
			exit(0);
		}
		else
		{
			//if (c != ' ' && c != '\n' && c != '\t' && state != 2 && state != 3 && state != 4 && c != '~')
			//if ((index == 0 || index == 1)&& counter != 0 )
			lexical[counter++] = c;
			if (state == 0 || state == 1)
				counter = 0;

		}
		if (state == 100 || state == 101 || state == 102 || state == 103 || state == 104 || state == 107 || state == 106)
		{

			//printf("I am still here \n");
			if (state != 102 && state != 107)
			{
				if (index != 26)
					fseek(sourceFile, -1, SEEK_CUR);
				counter--;
			}
			lexical[counter] = '\0';
			token.lex = MALLOC_ARRAY(counter, char);
			token.lex = lexical;
			token.lex[counter] = '\0';
			if (state == 104)
			{
				token.type = number;
				token.tokenValue = atoi(lexical);
			}
			else if (state == 103)
			{
				token.type = id;
			}
			else if (state == 101)
			{
				token.type = keyword;
			}
			else if (state == 100)
			{
				token.type = symbol;
			}
			else if (state == 102)
			{
				token.type = character;
			}
			else if (state == 107)
			{
				token.type = str;
			}
			else if (state == 106)
			{
				token.type = eof;
			}
			return token;
		}
	}
}
Token lookAHead()
{
	Token token;
	fpos_t position;
	fgetpos(sourceFile, &position);
	token = GetNextToken();
	fsetpos(sourceFile, &position);
	return token;
}